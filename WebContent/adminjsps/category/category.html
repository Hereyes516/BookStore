<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="__PUBLIC__/Admin/images/favicon.png" />
    <title>Clean Zone</title>
    <!-- <link rel="stylesheet" type="text/css" href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,400italic,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href='http://fonts.googleapis.com/css?family=Raleway:300,200,100' rel='stylesheet' type='text/css'> -->
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/jquery.gritter/css/jquery.gritter.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/fonts/font-awesome-4/css/font-awesome.min.css" />
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    	<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/jquery.nanoscroller/nanoscroller.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/jquery.easypiechart/jquery.easy-pie-chart.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/bootstrap.switch/bootstrap-switch.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/jquery.select2/select2.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/bootstrap.slider/css/slider.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/jquery.icheck/skins/square/blue.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/jquery.niftymodals/css/component.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/js/jquery.icheck/skins/square/blue.css" />
    <!-- Custom styles for this template -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/style.css" />
</head>

<body>
    <!-- 固定导航栏 -->
    <include file="Public/navbar" />
    <div id="cl-wrapper" class="fixed-menu">
        <!-- 固定测试栏 -->
        <include file="Public/sidebar" />
        <div class="container-fluid" id="pcont">
            <div class="page-head">
                <h2>游戏管理</h2>
                <ol class="breadcrumb">
                    <li><a href="#">首页</a></li>
                    <li><a href="#">游戏管理</a></li>
                    <li class="active">游戏类别管理</li>
                </ol>
            </div>
            <div class="cl-mcont">
                <div class="row">
                    <div class="col-sm-12 col-md-12">
                        <div class="block-flat">
                            <div class="header">
                            	<div class="row">
	                            	<div class="col-sm-12 col-md-12">
		                            	<div class="pull-right"><button class="btn btn-primary md-trigger btn-add" data-modal="colored-primary">添加新类别</button></div>
		                            	<div class="pull-left"><h3>类别列表</h3></div>
	                            	</div>
                            	</div>
                            </div>
                            <div class="content">
                                <table class="no-border">
                                    <thead class="no-border">
                                        <tr>
                                            <th style="width:3%;">
                                                <input class="icheck" id="check-all" type="checkbox" name="checkall">
                                            </th>
                                            <th class="text-center" style="width:7%;">
                                            	<strong>类别ID</strong>
                                            </th>
                                            <th class="text-center" style="width:25%;">
                                            	<strong>类名名称</strong>
                                            </th>
                                            <th class="text-center" style="width:25%;">
                                            	<strong>类别权重</strong>
                                            </th>
                                            <th class="text-center" style="width:25%;">
                                            	<strong>游戏数量</strong>
                                            </th>
                                            <th class="text-center" style="width:15%;">
                                            	<strong>操作</strong>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody class="no-border-y">
                                    	<volist name="categorys" id="vo">
	                                        <tr>
	                                            <td><input type="checkbox" class="icheck"></td>
	                                            <td class="text-center">{$vo.category_id}</td>
	                                            <td class="text-center">{$vo.name}</td>
	                                            <td class="text-center">{$vo.weight}</td>
	                                            <td class="text-center">{$vo.game_number}</td>
	                                            <td class="text-center">
	                                                <div class="btn-group">
	                                                    <button type="button" class="btn btn-primary dropdown-toggle btn-xs" data-toggle="dropdown">
	                                                    	<i class="fa fa-pencil fa-lg"></i>编辑<span class="caret"></span>
	                                                        <span class="sr-only"></span>
	                                                    </button>
	                                                    <ul class="dropdown-menu" role="menu">
	                                                        <li class="md-trigger modify" data-modal="colored-primary"><a href="#"><i class="fa fa-pencil"></i>修改类别信息</a></li>
	                                                        <li class="md-trigger delete" data-modal="colored-danger"><a href="#"><i class="fa fa-times"></i>删除该类别</a></li>
	                                                    </ul>
	                                                </div>
	                                            </td>
	                                        </tr>
                                    	</volist>
                                    </tbody>
                                </table>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        <div class="pull-left">
                                            <button type="button" class="btn btn-primary btn-sm">批量删除</button>
                                            <button type="button" class="btn btn-primary btn-sm">全部导出</button>
                                        </div>
                                        <div class="pull-right">
			                                {$page}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <include file="Public/modal" />
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.sparkline/jquery.sparkline.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/behaviour/general.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.nestable/jquery.nestable.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/bootstrap.switch/bootstrap-switch.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.select2/select2.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/bootstrap.slider/js/bootstrap-slider.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.gritter/js/jquery.gritter.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.icheck/icheck.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.niftymodals/js/jquery.modalEffects.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            //initialize the javascript
            App.init();
            $("#check-all").on('ifChanged', function() {
                var checkboxes = $(".no-border-y").find(':checkbox');
                if ($(this).is(':checked')) {
                    checkboxes.iCheck('check');
                } else {
                    checkboxes.iCheck('uncheck');
                }
            });
            
            var id, name, weight;
            $('.btn-add').click( function() {
            	$('#category-name').val('');
            	$('#category-weight').val('');
            	$('#colored-primary .modal-header>h3').text('添加新类别');
            	$('.modal-footer>button.btn-success').data('group','add');
            });
            
            $('.modify').click( function() {
            	id 		= $(this).closest('tr').children(':eq(1)').text();
            	name 	= $(this).closest('tr').children(':eq(2)').text();
            	weight 	= $(this).closest('tr').children(':eq(3)').text();
            	$('#category-name').val(name);
            	$('#category-weight').val(weight);
            	$('#colored-primary .modal-header>h3').text('修改信息');
            	$('.modal-footer>button.btn-success').data('group','modify');
            });
            
            $('.delete').click( function() {
            	id = $(this).closest('tr').children(':eq(1)').text();
            });
            
            $('.modal-footer>button.btn-success').click( function() {
            	var group = $(this).data('group');
            	if('add' == group){
            		console.log("aa");
            	}
            	else if('modify' == group){
            		if(name == $('#category-name').val().toString() && weight == $('#category-weight').val().toString()){
            			console.log("什么都没修改");
            		}
            		else{
		            	$.ajax({
			        		url: '__CONTROLLER__/ajaxModifyCategory',
			        		type: 'POST',
			        		dataType: 'json',
			        		data: {
			        			'id' 		: id,
			        			'name' 		: $('#category-name').val(),
			        			'weight' 	: $('#category-weight').val()
			        		}
			        	})
			        	.done(function(result) {
			            	name 	= $('#category-name').val();
			            	weight 	= $('#category-weight').val();
			        		if(1 == result.code){
			        			$('tbody>tr:eq(' + (id-1) + ') :eq(5)').text(name);
			        			$('tbody>tr:eq(' + (id-1) + ') :eq(6)').text(weight);
			        		}
			        		else
			        			console.log(result.data);
			    		})
			    		.fail(function() {
			    			console.log("error");
		    			});
            		}
            	}
            });
            
            $('.modal-footer>button.btn-danger').click( function() {
            	$.ajax({
            		url: '__CONTROLLER__/ajaxDeleteCategory',
            		type: 'POST',
            		dataType: 'json',
            		data: {'id' : id}
            	})
            	.done(function(result) {
            		if(1 == result.code) {
	        			console.log("删除成功");
            		}
            		else
            			console.log(result.data);
        		})
        		.fail(function() {
        			console.log("error");
        		});
            });
            
            switch("__CONTROLLER__"){
	        	case "/Admin/Game":
	        		$('.fa-gamepad').parent().parent('li').addClass('open');
	        		$('.fa-gamepad').parent().next('ul').css('display','block');
	        		switch("__ACTION__"){
	        			case "/Admin/Game/index":
	        			case "/Admin/Game/add":
	        			case "/Admin/Game/mofidy":
	        				$('.fa-gamepad').parent().next().children(':eq(0)').addClass('active');
	        				break;
	        			case "/Admin/Game/category":
	        				$('.fa-gamepad').parent().next().children(':eq(1)').addClass('active');
	        				break;
	        			case "/Admin/Game/subject":
	        				$('.fa-gamepad').parent().next().children(':eq(2)').addClass('active');
	        				break;
	        		}
	        		break;
	        	case "/Admin/Index":
	        		switch("__ACTION__"){
		       			case "/Admin/Game/index":
		       			case "/Admin/Game/add":
		       			case "/Admin/Game/mofidy":
		       				$('.fa-gamepad').parent().next().children(':eq(0)').addClass('active');
		       				break;
		       			case "/Admin/Game/category":
		       				$('.fa-gamepad').parent().next().children(':eq(1)').addClass('active');
		       				break;
		       			case "/Admin/Game/subject":
		       				$('.fa-gamepad').parent().next().children(':eq(2)').addClass('active');
		       				break;
		       		}
	        		break;
	        	case "/Admin/User":
	        		break;
        }
        });
    </script>
    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" src="__PUBLIC__/Admin/js/behaviour/voice-commands.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.flot/jquery.flot.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.flot/jquery.flot.pie.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.flot/jquery.flot.resize.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/jquery.flot/jquery.flot.labels.js"></script>
</body>

</html>